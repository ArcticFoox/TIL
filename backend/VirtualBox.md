# VirtualBox

오라클에서 개발한 오픈소스 가상화 소프트웨어

하나의 물리적인 컴퓨터 위에 여러 개의 가상 머신을 실행하여 서로 다른 운영체제를 동시에 구동할 수 있게 해줌

## 구성 요소

| 구성 요소 | 설명 |
| --- | --- |
| **호스트 OS (Host OS)** | VirtualBox가 설치된 실제 운영체제 (예: Ubuntu, Windows, macOS 등) |
| **게스트 OS (Guest OS)** | VirtualBox 안에서 실행되는 가상 운영체제 (예: CentOS, Windows 등) |
| **가상 머신 (VM)** | 게스트 OS가 설치되어 실행되는 가상 시스템 |
| **가상 하드디스크 (VDI)** | 게스트 OS용 디스크 파일 (.vdi, .vmdk 등) |
| **VBoxManage** | VirtualBox CLI 명령어 도구 (자동화, 배치 스크립트용) |
| **게스트 추가 도구 (Guest Additions)** | 게스트 OS와 호스트 간 연동을 위한 추가 패키지 (화면 해상도, 폴더 공유 등) |

## 작동 원리

### CPU 가상화

CPU 명령어 중 특권 명령어(I/O, 페이지 테이블 접근 등)를 트랩(trap) 하여 가로채고,

이를 적절히 애뮬레이션하거나 호스트 커널을 통해 실행

**가상화 방식**

소프트웨어 가상화: CPU 명령어를 분석/변환

하드웨어 지원 가상화(VT-x, AMD-V): CPU의 가상화 확장 기능을 사용해 고속 처리

## 메모리 가상화

VirtualBox가 호스트 메모리 상에 별도의 영역을 마련하고 이를 게스트에 매핑

Shadow Page Tables(SPT): 가상 페이지 테이블을 복사해서 관리

Nested Page Tables(NPT, EPT) 최신 CPU에서 2단계 페이지 변환을 지원

### 디바이스 애뮬레이션

| 디바이스 | 에뮬레이션 방식 |
| --- | --- |
| HDD/SSD | VDI/VMDK 이미지로 가상 디스크 구현 |
| VGA 그래픽 카드 | 가상 VGA 에뮬레이션, VBoxVGA/VBoxSVGA 등 |
| 네트워크 | 가상 NIC (Intel PRO/1000, PCnet), NAT/Bridged 연결 |
| USB | USB 컨트롤러 에뮬레이션 후 장치 pass-through 가능 |

### I/O 가상화 (디스크, 네트워크 등)

게스트 OS의 I/O 요청은 호스트에서 수행

디스크 → 가상 하드디스크 파일(.vdi 등)에 쓰기

네트워크 → 호스트 OS의 네트워크 스택을 거쳐 외부와 통신

I/O 처리 방식은 성능과 보안을 위해 다양한 방식 지원

User-level device emulation: 일반 사용자 권한으로 작동

Host I/O APIs: 실제 파일 시스템, 소켓 인터페이스 등 활용

### 시간, 타이머, 인터럽트

케스트 OS가 RTC나 타이머를 사용할 때 VirtualBox는 이를 애뮬레이션된 타이머로 제공

인터럽트 역시 소프트웨어적으로 발생시켜 게스트 OS가 응답하게 만듦

## 네트워크 가상화

| 모드 | 설명 |
| --- | --- |
| **NAT** | 게스트가 외부 인터넷 접속 가능, 외부에서 접속 불가 |
| **Bridged Adapter** | 게스트가 호스트와 같은 네트워크 상에 존재 (사설 IP 할당) |
| **Host-only Adapter** | 게스트와 호스트 간 통신만 가능 |
| **Internal Network** | 게스트끼리만 통신 가능 (호스트와 격리됨) |

각 네트워크 구성은 VirtualBox가 내부적으로 가상 스위치 및 라우터 역할을 하면서 수행

## 추가 기능

| 기능 | 설명 |
| --- | --- |
| **VT-x/AMD-V** | Intel/AMD 하드웨어 가상화 기능, 가상화 성능 향상 |
| **Nested Virtualization** | 게스트 OS 안에서 다시 가상화 가능 (ex: Docker+KVM 등) |
| **3D 가속** | 게스트에서 그래픽 가속 기능 사용 가능 (OpenGL 등) |
| **PCI Passthrough (제한적)** | 특정 PCI 장치를 게스트에 직접 전달 (VirtualBox에선 제한됨) |

## 요약

```java
+---------------------+
|    게스트 OS        |
| (Windows, Linux 등) |
+---------------------+
         ↓
  [가상 하드웨어] ← VBox가 제공
         ↓
+---------------------+
| VirtualBox (Hypervisor) |
| - CPU 가상화         |
| - 메모리 가상화      |
| - 디바이스 에뮬      |
+---------------------+
         ↓
+---------------------+
|   호스트 OS         |
| (Ubuntu 등)         |
+---------------------+
         ↓
     물리 하드웨어

```